<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Flappy Bird</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #4ec0ca;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        #gameContainer {
            position: relative;
            border: 3px solid #543847;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        canvas { display: block; }

        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            z-index: 10;
        }
        #overlay.hidden { display: none; }

        #overlay h1 {
            color: #fff; font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }
        #overlay p {
            color: #fff; font-size: 18px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        #overlay .score-display {
            color: #FFD700; font-size: 24px; font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }
        #overlay .word-display {
            color: #fff; font-size: 32px; font-weight: bold;
            letter-spacing: 4px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
            font-family: monospace;
        }

        #overlay button {
            padding: 12px 32px; font-size: 20px;
            background: #e8a43a; color: #fff;
            border: 3px solid #543847; border-radius: 12px;
            cursor: pointer; font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        #overlay button:hover { transform: scale(1.05); }
        #overlay button:active { transform: scale(0.95); }

        /* ---- Full-screen screens ---- */
        .fullscreen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 100; cursor: pointer;
            touch-action: manipulation;
        }
        .fullscreen.hidden { display: none; }

        /* Welcome */
        #welcome {
            background: linear-gradient(135deg, #ff6b8a, #ff4571, #d63384);
        }
        .hearts {
            position: absolute; width: 100%; height: 100%;
            overflow: hidden; pointer-events: none;
        }
        .heart {
            position: absolute; font-size: 24px;
            animation: floatHeart linear infinite; opacity: 0.5;
        }
        @keyframes floatHeart {
            0%   { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10%  { opacity: 0.6; }
            90%  { opacity: 0.6; }
            100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
        }
        .welcome-heart {
            font-size: 80px;
            animation: pulse 1.2s ease-in-out infinite;
            margin-bottom: 24px;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        .welcome-text {
            color: #fff; font-size: 28px; font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            padding: 0 24px; line-height: 1.5;
            max-width: 360px; margin-bottom: 32px;
        }
        .welcome-tap {
            color: rgba(255,255,255,0.85); font-size: 18px;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
            animation: tapPulse 2s ease-in-out infinite;
        }
        @keyframes tapPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* Rules */
        #rules {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        .rules-icon {
            font-size: 60px; margin-bottom: 20px;
        }
        .rules-title {
            color: #FFD700; font-size: 26px; font-weight: bold;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.4);
            margin-bottom: 24px;
        }
        .rules-text {
            color: #fff; font-size: 18px;
            text-align: center; line-height: 1.7;
            padding: 0 28px; max-width: 360px;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
            margin-bottom: 16px;
        }
        .rules-word-preview {
            font-family: monospace;
            font-size: 30px; font-weight: bold;
            letter-spacing: 6px; color: #FFD700;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.4);
            margin-bottom: 28px;
        }
        .rules-btn {
            padding: 14px 40px; font-size: 22px;
            background: #ff4571; color: #fff;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 14px; cursor: pointer;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }
        .rules-btn:hover { transform: scale(1.05); }
        .rules-btn:active { transform: scale(0.95); }

        /* Win screen */
        #winScreen {
            background: linear-gradient(135deg, #f093fb, #f5576c, #ff6b8a);
        }
        .win-icon { font-size: 70px; margin-bottom: 16px; }
        .win-title {
            color: #FFD700; font-size: 30px; font-weight: bold;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.4);
            margin-bottom: 12px;
        }
        .win-word {
            font-family: monospace;
            font-size: 36px; font-weight: bold;
            letter-spacing: 6px; color: #fff;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.4);
            margin-bottom: 8px;
            animation: pulse 1.5s ease-in-out infinite;
        }
        .win-sub {
            color: rgba(255,255,255,0.9); font-size: 18px;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
            margin-bottom: 24px;
        }
    </style>
</head>
<body>
    <!-- Welcome screen -->
    <div id="welcome" class="fullscreen">
        <div class="hearts" id="heartsContainer"></div>
        <div class="welcome-heart">&#10084;&#65039;</div>
        <div class="welcome-text">&#128149; &#1051;&#1102;&#1073;&#1080;&#1084;&#1072;&#1103;, &#1087;&#1086;&#1079;&#1076;&#1088;&#1072;&#1074;&#1083;&#1103;&#1102; &#1089; 14 &#1092;&#1077;&#1074;&#1088;&#1072;&#1083;&#1103;! &#128149;</div>
        <div class="welcome-tap">&#1045;&#1089;&#1083;&#1080; &#1093;&#1086;&#1095;&#1077;&#1096;&#1100; &#1089;&#1074;&#1086;&#1081; &#1087;&#1086;&#1076;&#1072;&#1088;&#1086;&#1082; &#8212; &#1090;&#1072;&#1087;&#1085;&#1080; &#128071;</div>
    </div>

    <!-- Rules screen -->
    <div id="rules" class="fullscreen hidden">
        <div class="rules-icon">&#127918;</div>
        <div class="rules-title">&#1050;&#1072;&#1082; &#1080;&#1075;&#1088;&#1072;&#1090;&#1100;?</div>
        <div class="rules-text">
            &#1058;&#1077;&#1073;&#1077; &#1085;&#1091;&#1078;&#1085;&#1086; &#1086;&#1090;&#1082;&#1088;&#1099;&#1090;&#1100; &#1089;&#1083;&#1086;&#1074;&#1086;, &#1075;&#1076;&#1077; &#1089;&#1087;&#1088;&#1103;&#1090;&#1072;&#1085; &#1090;&#1074;&#1086;&#1081; &#1087;&#1086;&#1076;&#1072;&#1088;&#1086;&#1082;!<br><br>
            &#1050;&#1072;&#1078;&#1076;&#1099;&#1077; 5 &#1086;&#1095;&#1082;&#1086;&#1074; &#1086;&#1090;&#1082;&#1088;&#1099;&#1074;&#1072;&#1102;&#1090; &#1089;&#1083;&#1091;&#1095;&#1072;&#1081;&#1085;&#1091;&#1102; &#1073;&#1091;&#1082;&#1074;&#1091;.<br>
            &#1059;&#1087;&#1072;&#1083;&#1072; &#8212; &#1089;&#1095;&#1105;&#1090; &#1089;&#1073;&#1088;&#1072;&#1089;&#1099;&#1074;&#1072;&#1077;&#1090;&#1089;&#1103;, &#1085;&#1086; &#1073;&#1091;&#1082;&#1074;&#1099; &#1086;&#1089;&#1090;&#1072;&#1102;&#1090;&#1089;&#1103;!
        </div>
        <div class="rules-word-preview">? ? ? ? ?&nbsp; &nbsp;? ? ? ? ?</div>
        <button class="rules-btn" id="rulesBtn">&#1053;&#1072;&#1095;&#1072;&#1090;&#1100;! &#128293;</button>
    </div>

    <!-- Win screen -->
    <div id="winScreen" class="fullscreen hidden">
        <div class="hearts" id="winHeartsContainer"></div>
        <div class="win-icon">&#127881;&#127873;&#127881;</div>
        <div class="win-title">&#1058;&#1099; &#1086;&#1090;&#1082;&#1088;&#1099;&#1083;&#1072; &#1089;&#1083;&#1086;&#1074;&#1086;!</div>
        <div class="win-word" id="winWord"></div>
        <div class="win-sub">&#1048;&#1076;&#1080; &#1079;&#1072; &#1087;&#1086;&#1076;&#1072;&#1088;&#1082;&#1086;&#1084;! &#128149;</div>
    </div>

    <!-- Game -->
    <div id="gameContainer">
        <canvas id="game"></canvas>
        <div id="overlay">
            <h1>Flappy Bird</h1>
            <p id="overlayText">&#1058;&#1072;&#1087;&#1085;&#1080; &#1095;&#1090;&#1086;&#1073;&#1099; &#1083;&#1077;&#1090;&#1077;&#1090;&#1100;</p>
            <div class="word-display" id="overlayWord"></div>
            <div class="score-display hidden" id="finalScore"></div>
            <button id="startBtn">&#1048;&#1075;&#1088;&#1072;&#1090;&#1100;</button>
        </div>
    </div>

    <script>
    // Clear old version data
    localStorage.removeItem('flappyRevealed');
    localStorage.removeItem('flappyBest');

    // ---- Secret word ----
    const SECRET = 'БЕЛЫЕ ШТАНЫ';
    // Only actual letters (no spaces)
    const LETTER_INDICES = []; // indices of letters in SECRET (excluding spaces)
    SECRET.split('').forEach((ch, i) => { if (ch !== ' ') LETTER_INDICES.push(i); });
    const TOTAL_LETTERS = LETTER_INDICES.length; // 10
    const POINTS_PER_LETTER = 5;

    // Reveal order: shuffled indices, persistent across sessions
    let revealOrder = JSON.parse(localStorage.getItem('flappyRevealOrder') || 'null');
    if (!revealOrder || revealOrder.length !== TOTAL_LETTERS) {
        revealOrder = [...LETTER_INDICES];
        for (let i = revealOrder.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [revealOrder[i], revealOrder[j]] = [revealOrder[j], revealOrder[i]];
        }
        localStorage.setItem('flappyRevealOrder', JSON.stringify(revealOrder));
    }

    // Set of revealed positions in SECRET
    let revealedSet = new Set(JSON.parse(localStorage.getItem('flappyRevealedSet') || '[]'));
    let revealedCount = revealedSet.size;

    function saveRevealed() {
        localStorage.setItem('flappyRevealedSet', JSON.stringify([...revealedSet]));
    }

    function getWordDisplay() {
        return SECRET.split('').map((ch, i) => {
            if (ch === ' ') return '  ';
            return revealedSet.has(i) ? ch : '_';
        }).join(' ');
    }

    function getNextThreshold() {
        return (revealedCount + 1) * POINTS_PER_LETTER;
    }

    // ---- Welcome screen ----
    (function() {
        const container = document.getElementById('heartsContainer');
        const emojis = ['\u2764\ufe0f', '\uD83D\uDC95', '\uD83D\uDC96', '\uD83D\uDC97', '\uD83D\uDC98', '\uD83D\uDC9D'];
        for (let i = 0; i < 20; i++) {
            const h = document.createElement('div');
            h.className = 'heart';
            h.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            h.style.left = Math.random() * 100 + '%';
            h.style.fontSize = (16 + Math.random() * 24) + 'px';
            h.style.animationDuration = (4 + Math.random() * 6) + 's';
            h.style.animationDelay = (Math.random() * 5) + 's';
            container.appendChild(h);
        }

        const welcome = document.getElementById('welcome');
        function showRules() {
            welcome.classList.add('hidden');
            document.getElementById('rules').classList.remove('hidden');
        }
        welcome.addEventListener('click', showRules);
        welcome.addEventListener('touchstart', function(e) { e.preventDefault(); showRules(); });
    })();

    // ---- Win screen hearts ----
    (function() {
        const container = document.getElementById('winHeartsContainer');
        const emojis = ['\u2764\ufe0f', '\uD83D\uDC95', '\uD83D\uDC96', '\uD83D\uDC97', '\uD83D\uDC98', '\uD83D\uDC9D'];
        for (let i = 0; i < 20; i++) {
            const h = document.createElement('div');
            h.className = 'heart';
            h.textContent = emojis[Math.floor(Math.random() * emojis.length)];
            h.style.left = Math.random() * 100 + '%';
            h.style.fontSize = (16 + Math.random() * 24) + 'px';
            h.style.animationDuration = (4 + Math.random() * 6) + 's';
            h.style.animationDelay = (Math.random() * 5) + 's';
            container.appendChild(h);
        }
    })();

    // ---- Game ----
    (function() {
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const overlayText = document.getElementById('overlayText');
        const overlayWord = document.getElementById('overlayWord');
        const finalScore = document.getElementById('finalScore');
        const startBtn = document.getElementById('startBtn');
        const rulesBtn = document.getElementById('rulesBtn');

        const MAX_W = 400, MAX_H = 600;
        let W, H, scale;

        function resize() {
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            scale = Math.min(vw / MAX_W, vh / MAX_H, 1);
            W = Math.floor(MAX_W * scale);
            H = Math.floor(MAX_H * scale);
            canvas.width = W;
            canvas.height = H;
        }
        resize();
        window.addEventListener('resize', resize);

        const s = () => scale;
        const GRAVITY = 0.45;
        const FLAP_FORCE = -7.5;
        const PIPE_WIDTH = 52;
        const PIPE_GAP = 140;
        const PIPE_SPEED = 2.2;
        const PIPE_SPAWN = 160;
        const BIRD_SIZE = 20;
        const GROUND_H = 60;

        let bird, pipes, score, gameState, frame, groundX;
        let particles = [];

        function spawnParticles(x, y, isLetter) {
            const count = isLetter ? 24 : 12;
            for (let i = 0; i < count; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = (2 + Math.random() * 4) * s();
                const isHeart = Math.random() < 0.5;
                particles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed - 2 * s(),
                    life: 1.0,
                    decay: 0.008 + Math.random() * 0.008,
                    size: (isHeart ? 14 : 8) + Math.random() * 8,
                    type: isHeart ? 'heart' : 'sparkle',
                    color: isHeart
                        ? ['#ff4571','#ff6b8a','#d63384','#ff85a1'][Math.floor(Math.random()*4)]
                        : ['#FFD700','#FFF','#ffec80','#ffd0e8'][Math.floor(Math.random()*4)],
                    rotation: Math.random() * Math.PI * 2,
                    rotSpeed: (Math.random() - 0.5) * 0.2
                });
            }
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const pt = particles[i];
                pt.x += pt.vx;
                pt.y += pt.vy;
                pt.vy += 0.1 * s();
                pt.vx *= 0.99;
                pt.life -= pt.decay;
                pt.rotation += pt.rotSpeed;
                if (pt.life <= 0) particles.splice(i, 1);
            }
        }

        function drawParticles() {
            for (const pt of particles) {
                ctx.save();
                ctx.globalAlpha = Math.max(0, pt.life);
                ctx.translate(pt.x, pt.y);
                ctx.rotate(pt.rotation);
                const sz = pt.size * s() * (0.5 + pt.life * 0.5);

                if (pt.type === 'heart') {
                    // Simple heart shape
                    ctx.fillStyle = pt.color;
                    ctx.font = `${Math.round(sz)}px serif`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('\u2764', 0, 0);
                } else {
                    // Sparkle: filled circle with glow
                    ctx.fillStyle = pt.color;
                    ctx.shadowColor = pt.color;
                    ctx.shadowBlur = sz * 0.8;
                    ctx.beginPath();
                    ctx.arc(0, 0, sz * 0.4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }

                ctx.restore();
            }
        }

        function init() {
            bird = { x: W * 0.28, y: H * 0.45, vy: 0, rotation: 0, flapFrame: 0 };
            pipes = [];
            particles = [];
            score = 0;
            frame = 0;
            groundX = 0;
            gameState = 'ready';
        }

        function flap() {
            if (gameState === 'dead') return;
            if (gameState === 'ready') {
                gameState = 'playing';
                overlay.classList.add('hidden');
            }
            bird.vy = FLAP_FORCE * s();
            bird.flapFrame = frame;
        }

        function spawnPipe() {
            const minY = 80 * s();
            const maxY = H - GROUND_H * s() - PIPE_GAP * s() - minY;
            const topH = minY + Math.random() * maxY;
            pipes.push({ x: W + 10, topH, scored: false });
        }

        function checkWin() {
            if (revealedCount >= TOTAL_LETTERS) {
                gameState = 'won';
                document.getElementById('winWord').textContent = SECRET;
                document.getElementById('winScreen').classList.remove('hidden');
            }
        }

        function update() {
            if (gameState !== 'playing') return;
            frame++;

            bird.vy += GRAVITY * s();
            bird.y += bird.vy;

            if (bird.vy < 0) bird.rotation = Math.max(-0.5, bird.vy * 0.08);
            else bird.rotation = Math.min(1.2, bird.vy * 0.06);

            const groundY = H - GROUND_H * s();
            if (bird.y + BIRD_SIZE * s() > groundY) {
                bird.y = groundY - BIRD_SIZE * s();
                die(); return;
            }
            if (bird.y < 0) { bird.y = 0; bird.vy = 0; }

            if (frame % Math.floor(PIPE_SPAWN / (PIPE_SPEED * s())) === 0) spawnPipe();

            const bx = bird.x, by = bird.y;
            const bs = BIRD_SIZE * s();
            const pw = PIPE_WIDTH * s();
            const pg = PIPE_GAP * s();

            for (let i = pipes.length - 1; i >= 0; i--) {
                const p = pipes[i];
                p.x -= PIPE_SPEED * s();

                if (p.x + pw < 0) { pipes.splice(i, 1); continue; }

                if (!p.scored && p.x + pw < bx) {
                    p.scored = true;
                    score++;
                    const birdCx = bird.x + bs / 2;
                    const birdCy = bird.y + bs / 2;
                    spawnParticles(birdCx, birdCy, false);
                    // Reveal a letter every 5 points
                    if (revealedCount < TOTAL_LETTERS && score === getNextThreshold()) {
                        spawnParticles(birdCx, birdCy, true);
                        const pos = revealOrder[revealedCount];
                        revealedSet.add(pos);
                        revealedCount = revealedSet.size;
                        saveRevealed();
                        if (revealedCount >= TOTAL_LETTERS) {
                            checkWin();
                            return;
                        }
                    }
                }

                const margin = 3 * s();
                if (bx + bs - margin > p.x && bx + margin < p.x + pw) {
                    if (by + margin < p.topH || by + bs - margin > p.topH + pg) {
                        die(); return;
                    }
                }
            }

            groundX -= PIPE_SPEED * s();
            if (groundX <= -24 * s()) groundX = 0;

            updateParticles();
        }

        function die() {
            gameState = 'dead';
            overlay.classList.remove('hidden');
            overlayText.textContent = 'Game Over';
            overlayWord.textContent = getWordDisplay();
            const left = TOTAL_LETTERS - revealedCount;
            if (left > 0) {
                finalScore.textContent = `\u0421\u0447\u0451\u0442: ${score} | \u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0431\u0443\u043a\u0432\u0430: ${getNextThreshold()} \u043e\u0447\u043a\u043e\u0432`;
            } else {
                finalScore.textContent = '\u0412\u0441\u0435 \u0431\u0443\u043a\u0432\u044b \u043e\u0442\u043a\u0440\u044b\u0442\u044b!';
            }
            finalScore.classList.remove('hidden');
            startBtn.textContent = '\u0415\u0449\u0451 \u0440\u0430\u0437';
        }

        // Drawing
        function drawBackground() {
            const grd = ctx.createLinearGradient(0, 0, 0, H);
            grd.addColorStop(0, '#4ec0ca');
            grd.addColorStop(1, '#71c8d6');
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, W, H);
            ctx.fillStyle = 'rgba(255,255,255,0.6)';
            drawCloud(50*s(), 80*s(), 40*s());
            drawCloud(200*s(), 50*s(), 30*s());
            drawCloud(320*s(), 110*s(), 35*s());
        }
        function drawCloud(x, y, r) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI*2);
            ctx.arc(x+r*0.8, y-r*0.3, r*0.7, 0, Math.PI*2);
            ctx.arc(x+r*1.4, y, r*0.6, 0, Math.PI*2);
            ctx.fill();
        }
        function drawPipe(p) {
            const pw = PIPE_WIDTH*s(), pg = PIPE_GAP*s();
            const capH = 26*s(), capExtra = 6*s(), borderW = 2*s();
            ctx.fillStyle = '#74bf2e';
            ctx.fillRect(p.x, 0, pw, p.topH);
            ctx.fillStyle = '#548a20';
            ctx.fillRect(p.x, 0, borderW, p.topH);
            ctx.fillRect(p.x+pw-borderW, 0, borderW, p.topH);
            ctx.fillStyle = '#74bf2e';
            ctx.fillRect(p.x-capExtra, p.topH-capH, pw+capExtra*2, capH);
            ctx.strokeStyle = '#3b2d1e'; ctx.lineWidth = borderW;
            ctx.strokeRect(p.x-capExtra, p.topH-capH, pw+capExtra*2, capH);
            ctx.fillStyle = 'rgba(255,255,255,0.15)';
            ctx.fillRect(p.x+6*s(), 0, 8*s(), p.topH-capH);
            const botY = p.topH+pg, botH = H-botY;
            ctx.fillStyle = '#74bf2e';
            ctx.fillRect(p.x, botY, pw, botH);
            ctx.fillStyle = '#548a20';
            ctx.fillRect(p.x, botY, borderW, botH);
            ctx.fillRect(p.x+pw-borderW, botY, borderW, botH);
            ctx.fillStyle = '#74bf2e';
            ctx.fillRect(p.x-capExtra, botY, pw+capExtra*2, capH);
            ctx.strokeStyle = '#3b2d1e'; ctx.lineWidth = borderW;
            ctx.strokeRect(p.x-capExtra, botY, pw+capExtra*2, capH);
            ctx.fillStyle = 'rgba(255,255,255,0.15)';
            ctx.fillRect(p.x+6*s(), botY+capH, 8*s(), botH-capH);
        }
        function drawBird() {
            const bs = BIRD_SIZE*s();
            const cx = bird.x+bs/2, cy = bird.y+bs/2;
            ctx.save(); ctx.translate(cx, cy); ctx.rotate(bird.rotation);
            ctx.fillStyle = '#f8c53a';
            ctx.beginPath(); ctx.ellipse(0,0,bs*0.65,bs*0.5,0,0,Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#543847'; ctx.lineWidth = 1.5*s(); ctx.stroke();
            ctx.fillStyle = '#fae89d';
            ctx.beginPath(); ctx.ellipse(bs*0.05,bs*0.15,bs*0.35,bs*0.3,0,0,Math.PI*2); ctx.fill();
            const wingFlap = Math.sin((frame-bird.flapFrame)*0.5)*0.2;
            ctx.fillStyle = '#e8a43a';
            ctx.beginPath(); ctx.ellipse(-bs*0.1,bs*0.05+wingFlap*bs,bs*0.35,bs*0.22,-0.3,0,Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#543847'; ctx.lineWidth = 1*s(); ctx.stroke();
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(bs*0.22,-bs*0.12,bs*0.2,0,Math.PI*2); ctx.fill();
            ctx.strokeStyle = '#543847'; ctx.lineWidth = 1*s(); ctx.stroke();
            ctx.fillStyle = '#000';
            ctx.beginPath(); ctx.arc(bs*0.28,-bs*0.12,bs*0.09,0,Math.PI*2); ctx.fill();
            ctx.fillStyle = '#e87040';
            ctx.beginPath(); ctx.moveTo(bs*0.45,-bs*0.02); ctx.lineTo(bs*0.8,bs*0.06); ctx.lineTo(bs*0.45,bs*0.15); ctx.closePath(); ctx.fill();
            ctx.strokeStyle = '#543847'; ctx.lineWidth = 1*s(); ctx.stroke();
            ctx.restore();
        }
        function drawGround() {
            const gH = GROUND_H*s(), gY = H-gH;
            ctx.fillStyle = '#ded895'; ctx.fillRect(0, gY, W, gH);
            ctx.fillStyle = '#d2b34a'; ctx.fillRect(0, gY, W, 4*s());
            ctx.fillStyle = '#8bc34a';
            const tW = 24*s();
            for (let x = groundX; x < W+tW; x += tW) {
                ctx.beginPath(); ctx.moveTo(x, gY); ctx.lineTo(x+tW*0.5, gY-6*s()); ctx.lineTo(x+tW, gY); ctx.fill();
            }
        }

        function drawScore() {
            if (gameState !== 'playing') return;
            const text = String(score);
            ctx.font = `bold ${32*s()}px Arial`;
            ctx.textAlign = 'center';
            ctx.strokeStyle = '#543847'; ctx.lineWidth = 4*s();
            ctx.strokeText(text, W/2, 50*s());
            ctx.fillStyle = '#fff';
            ctx.fillText(text, W/2, 50*s());
        }

        function drawWordBar() {
            if (gameState !== 'playing') return;
            const barH = 40 * s();
            const barY = H - GROUND_H*s() - barH;
            ctx.fillStyle = 'rgba(0,0,0,0.35)';
            ctx.fillRect(0, barY, W, barH);

            // Word
            const display = getWordDisplay();
            ctx.font = `bold ${15*s()}px monospace`;
            ctx.textAlign = 'center';
            ctx.fillStyle = '#FFD700';
            ctx.fillText(display, W/2, barY + 16*s());

            // Next letter hint
            if (revealedCount < TOTAL_LETTERS) {
                const next = getNextThreshold();
                ctx.font = `${11*s()}px Arial`;
                ctx.fillStyle = 'rgba(255,255,255,0.7)';
                ctx.fillText(`\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f \u0431\u0443\u043a\u0432\u0430: ${next} \u043e\u0447\u043a\u043e\u0432`, W/2, barY + 32*s());
            }
        }

        function drawReadyHint() {
            if (gameState !== 'ready') return;
            bird.y = H*0.45 + Math.sin(Date.now()*0.004)*8*s();
        }

        function draw() {
            drawBackground();
            pipes.forEach(drawPipe);
            drawGround();
            drawReadyHint();
            drawBird();
            drawParticles();
            drawScore();
            drawWordBar();
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        // Input
        function handleInput(e) {
            e.preventDefault();
            if (gameState === 'dead') return;
            flap();
        }
        canvas.addEventListener('pointerdown', handleInput);
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                e.preventDefault();
                if (gameState === 'dead') return;
                flap();
            }
        });

        startBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (revealedCount >= TOTAL_LETTERS) { checkWin(); return; }
            init();
            overlay.classList.add('hidden');
            overlayWord.textContent = '';
            finalScore.classList.add('hidden');
            gameState = 'ready';
        });

        rulesBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('rules').classList.add('hidden');
            if (revealedCount >= TOTAL_LETTERS) { checkWin(); return; }
            init();
            overlayWord.textContent = getWordDisplay();
        });

        // Prevent scroll on mobile
        document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });

        init();
        overlayWord.textContent = getWordDisplay();
        loop();
    })();
    </script>
</body>
</html>
